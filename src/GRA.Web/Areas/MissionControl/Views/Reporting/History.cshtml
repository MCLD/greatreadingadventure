@model GRA.Controllers.ViewModel.MissionControl.Reporting.ReportHistoryViewModel

<div class="card">
  <div class="card-header d-flex">
    <div class="fw-bold flex-grow-1">Report History</div>
  </div>
  <div class="card-body p-0">
    <table class="table table-sm table-bordered link-table">
      <thead>
        <tr>
          <th>Generated At</th>
          <th>Report Type</th>
          <th>Requested By</th>
          <th>Status</th>
          <th class="text-end">Duration</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
          @if (Model?.Requests?.Any() != true)
                {
                    <tr>
                        <td class="warning" colspan="6">No report runs found.</td>
                    </tr>
                }
          else
          {
                @foreach (var r in Model.Requests)
                {
                    var duration = (r.Started.HasValue && r.Finished.HasValue)
                        ? (r.Finished.Value - r.Started.Value)
                        : (TimeSpan?)null;

                <tr>
                  <td>@r.CreatedAt</td>
                  <td class="td-class">
                    <a class="rowlink"
                       asp-action="@nameof(GRA.Controllers.MissionControl.ReportingController.View)"
                       asp-route-id="@r.Id">
                                @(string.IsNullOrWhiteSpace(r.Name) ? $"Report #{r.ReportId}" : r.Name)
                    </a>
                  </td>
                  <td>@r.RequestedByUserId</td>
                  <td>
                            @if (r.Success == true)
                            {
                            <span class="badge bg-success">Success</span>
                            }
                            else if (r.Success == false)
                            {
                            <span class="badge bg-danger" title="@r.Message">Failed</span>
                            }
                            else if (r.Started.HasValue && !r.Finished.HasValue)
                            {
                            <span class="badge bg-info">Running</span>
                            }
                            else
                            {
                            <span class="badge bg-secondary">Queued</span>
                            }
                  </td>
                  <td class="text-end">@((duration?.TotalSeconds ?? 0).ToString("0"))s</td>
                  <td class="on-top gra-mc-icon">
                    <a class="btn btn-outline-secondary btn-sm" href="@Url.Action("Download", new { id = r.Id })">
                      <span class="fas fa-file-excel"></span> Excel
                    </a>
                  </td>
                </tr>
                }
          }
      </tbody>
    </table>
  </div>
</div>

<div class="mt-3">
  <paginate paginateModel="@Model"></paginate>
</div>

@section Scripts {
      <script>
        $(document).ready(function () {
          $('.td-class').each(function () {
            $(this).children('a.rowlink').height($(this).outerHeight());
          });
        });
        $(window).on('resize', function () {
          $('.td-class').each(function () {
            $(this).children('a.rowlink').height($(this).outerHeight());
          });
        });
      </script>
}

