@model GRA.Controllers.ViewModel.Challenge.ChallengeDetailViewModel

<form asp-controller="Challenge" asp-action="Edit" method="post" class="form-horizontal" role="form">

    <div class="row">
        <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="aaModalLabel">Add task</h4>
                    </div>
                    <div class="modal-body">
                        @Html.EditorFor(m => m.Task)
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal" style="margin-right: 1em;">Cancel</button>
                        <button type="submit" asp-action="AddTask" class="btn btn-primary pull-right" aria-label="Confirm">
                            Add
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="deleteModalLabel">Delete task</h4>
                    </div>
                    <div class="modal-body">
                        <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>
                        <span id="modal-text"></span>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal" style="margin-right: 1em;">Cancel</button>
                            <input id="Id" name="Id" type="hidden" />
                            <button type="submit" asp-action="DeleteTask" class="btn btn-danger pull-right" aria-label="Confirm">
                                <span class="fa fa-remove" aria-hidden="true"></span>
                                Delete
                            </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <h1>
                Edit Challenge - @Model.Challenge.Name
            </h1>
        </div>
    </div>



    <input asp-for="Challenge.Id" type="hidden" />

    <div class="form-group">
        <label asp-for="Challenge.Name" class="control-label col-sm-2"></label>
        <div class="col-sm-10">
            <input asp-for="Challenge.Name" class="form-control" />
            <span asp-validation-for="Challenge.Name" class="text-danger"></span>
        </div>
    </div>

    <div class="form-group">
        <label asp-for="Challenge.Description" class="control-label col-sm-2"></label>
        <div class="col-sm-10">
            <textarea asp-for="Challenge.Description" class="form-control"> </textarea>
            <span asp-validation-for="Challenge.Description" class="text-danger"></span>
        </div>
    </div>

    <div class="form-group">
        <label asp-for="Challenge.PointsAwarded" class="control-label col-sm-2"></label>
        <div class="col-sm-10">
            <input asp-for="Challenge.PointsAwarded" type="number" class="form-control" />
            <span asp-validation-for="Challenge.PointsAwarded" class="text-danger"></span>
        </div>
    </div>

    <div class="form-group">
        <label asp-for="Challenge.TasksToComplete" class="control-label col-sm-2"></label>
        <div class="col-sm-10">
            <input asp-for="Challenge.TasksToComplete" type="number" class="form-control" />
            <span asp-validation-for="Challenge.TasksToComplete" class="text-danger"></span>
        </div>
    </div>

    <h3>Tasks</h3>
    @if (Model.Challenge.tasks != null)
    {
        <table class="table table-condensed table-bordered link-table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Type</th>
                    <th width="103">&nbsp;</th>
                </tr>
            </thead>
            @foreach (var task in Model.Challenge.tasks)
            {
                <tr>
                    <td class="td-class">
                        <a data-toggle="modal" data-target="#deleteModal" class="rowlink">
                            @task.Title
                        </a>
                    </td>
                    <td>@task.ChallengeTaskType</td>
                    <td class="on-top" style="white-space:nowrap;">
                        <button asp-action="DecreaseTaskSort" asp-route-id="@task.Id" class="btn btn-default btn-xs">
                            <span class="fa fa-arrow-up"></span>
                        </button>
                        <button asp-action="IncreaseTaskSort" asp-route-id="@task.Id" class="btn btn-default btn-xs">
                            <span class="fa fa-arrow-down"></span>
                        </button>
                        <button type="button"
                                class="btn btn-danger btn-xs"
                                style="margin-left:16px;"
                                data-toggle="modal"
                                data-target="#deleteModal"
                                data-id="@task.Id"
                                data-name="@task.Title">
                            <span class="fa fa-remove" aria-hidden="true"></span>
                        </button>
                    </td>
                </tr>
            }
        </table>
    }
    <button type="button" data-toggle="modal" data-target="#addModal" class="btn btn-default">
        <span class="buttonText">Add Task</span>
    </button>

    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" id="Submit" name="Submit" value="Submit" class="btn btn-primary">
                <span class="buttonText">Save Changes</span>
                <span class="fa fa-spinner fa-pulse fa-lg fa-fw hidden"></span>
            </button>
        </div>
    </div>
</form>



@section scripts {
    <script>
        $(document).ready(function() {
            $('.td-class').each(function() {
                $(this).children('a.rowlink').height($(this).height() + 11);
            });
        });
        $(window).resize(function() {
            $('.td-class').each(function() {
                $(this).children('a.rowlink').height($(this).height() + 11);
            });
        });

        $('#deleteModal').on('show.bs.modal', function(event) {
            var button = $(event.relatedTarget);
            var id = button.data('id');
            var name = button.data('name');
            var modal = $(this);
            modal.find('#modal-text').text('Are you sure you wish to delete the task "' + name + '" ?');
            modal.find('#Id').val(id);
        })

        $('#Submit').on("click", function(e) {
            e.preventDefault();
            if (!$(this).hasClass('disabled'))
            {
                $(this).addClass('disabled');
                $(this).children('.fa-spinner').removeClass('hidden');
                $(this).parents('form:first').submit();
            }
        });
    </script>
}