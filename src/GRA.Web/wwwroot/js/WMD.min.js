"use strict";function getQueryVariable(n){for(var i,u=window.location.search.substring(1),r=u.split("&"),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]===n)return decodeURIComponent(i[1]);return null}function identity(n){return n}function returnFalse(){return!1}function HookCollection(){}var commonmark=window.commonmark,writer=new commonmark.HtmlRenderer({sourcepos:!0,safe:!1}),reader=new commonmark.Parser,render=function(n){if(n!==undefined){var t=writer.render(n),i=$("#preview");i[0].innerHTML=t;$("#preview a").attr("target","_blank")}},markSelection=function(){for(var t,i,u,f,e=$("#wmd-input").prop("selectionStart"),o=$("#wmd-input").val(),r=1,n=0;n<e;n++)o.charAt(n)==="\n"&&r++;if(t=$("#preview"),i=t.find("[data-sourcepos^='"+r+":'],[data-sourcepos*='-"+r+":']"),i.length==0)for(n=r-1;n>0;n--){if(f=t.find("[data-sourcepos*='-"+n+":']"),f.length>0)break;u=t.find("[data-sourcepos^='"+n+":']");u.length>0&&(i=u)}t.find(".selected").removeClass("selected");i.length>0&&i.addClass("selected")},parseAndRender=function(){var n=$("#wmd-input"),t=reader.parse(n.val());render(t);markSelection()},Markdown;$(document).ready(function(){var n=$("#wmd-input");parseAndRender();$(".wmd-button").click(function(){parseAndRender()});n.bind("input propertychange",parseAndRender);n.on("keyup click focus",markSelection)});Markdown=typeof exports=="object"&&typeof require=="function"?exports:{};HookCollection.prototype={chain:function(n,t){var i=this[n];if(!i)throw new Error("unknown hook "+n);this[n]=i===identity?t:function(){var n=Array.prototype.slice.call(arguments,0);return n[0]=i.apply(null,n),t.apply(null,n)}},set:function(n,t){if(!this[n])throw new Error("unknown hook "+n);this[n]=t},addNoop:function(n){this[n]=identity},addFalse:function(n){this[n]=returnFalse}};Markdown.HookCollection=HookCollection,function(){function h(){}function p(){this.buttonBar=n.getElementById("wmd-button-bar");this.input=n.getElementById("wmd-input")}function w(n,i){var l=this,e=[],r=0,o="none",f,v,a,s=function(n,t){o!=n&&(o=n,t||y());u.isIE&&o=="moving"?a=null:v=setTimeout(h,1)},h=function(n){a=new c(i,n);v=undefined};this.setCommandMode=function(){o="command";y();v=setTimeout(h,0)};this.canUndo=function(){return r>1};this.canRedo=function(){return e[r+1]?!0:!1};this.undo=function(){l.canUndo()&&(f?(f.restore(),f=null):(e[r]=new c(i),e[--r].restore(),n&&n()));o="none";i.input.focus();h()};this.redo=function(){l.canRedo()&&(e[++r].restore(),n&&n());o="none";i.input.focus();h()};var y=function(){var t=a||new c(i);if(!t)return!1;if(o=="moving"){f||(f=t);return}f&&(e[r-1].text!=f.text&&(e[r++]=f),f=null);e[r++]=t;e[r+1]=null;n&&n()},p=function(n){var t=!1,i,r;if((n.ctrlKey||n.metaKey)&&!n.altKey){i=n.charCode||n.keyCode;r=String.fromCharCode(i);switch(r.toLowerCase()){case"y":l.redo();t=!0;break;case"z":n.shiftKey?l.redo():l.undo();t=!0}}if(t){n.preventDefault&&n.preventDefault();window.event&&(window.event.returnValue=!1);return}},w=function(n){if(!n.ctrlKey&&!n.metaKey){var t=n.keyCode;t>=33&&t<=40||t>=63232&&t<=63235?s("moving"):t==8||t==46||t==127?s("deleting"):t==13?s("newlines"):t==27?s("escape"):(t<16||t>20)&&t!=91&&s("typing")}},b=function(){t.addEvent(i.input,"keypress",function(n){(n.ctrlKey||n.metaKey)&&!n.altKey&&(n.keyCode==89||n.keyCode==90)&&n.preventDefault()});var n=function(){(u.isIE||a&&a.text!=i.input.value)&&v==undefined&&(o="paste",y(),h())};t.addEvent(i.input,"keydown",p);t.addEvent(i.input,"keydown",w);t.addEvent(i.input,"mousedown",function(){s("moving")});i.input.onpaste=n;i.input.ondrop=n},k=function(){b();h(!0);y()};k()}function c(i,r){var e=this,f=i.input;this.init=function(){t.isVisible(f)&&(r||!n.activeElement||n.activeElement===f)&&(this.setInputAreaSelectionStartEnd(),this.scrollTop=f.scrollTop,(!this.text&&f.selectionStart||f.selectionStart===0)&&(this.text=f.value))};this.setInputAreaSelection=function(){if(t.isVisible(f))if(f.selectionStart===undefined||u.isOpera){if(n.selection){if(n.activeElement&&n.activeElement!==f)return;f.focus();var i=f.createTextRange();i.moveStart("character",-f.value.length);i.moveEnd("character",-f.value.length);i.moveEnd("character",e.end);i.moveStart("character",e.start);i.select()}}else f.focus(),f.selectionStart=e.start,f.selectionEnd=e.end,f.scrollTop=e.scrollTop};this.setInputAreaSelectionStartEnd=function(){var s,h;if(!i.ieCachedRange&&(f.selectionStart||f.selectionStart===0))e.start=f.selectionStart,e.end=f.selectionEnd;else if(n.selection){e.text=t.fixEolChars(f.value);var r=i.ieCachedRange||n.selection.createRange(),u=t.fixEolChars(r.text),o="\x07",c=o+u+o;if(r.text=c,s=t.fixEolChars(f.value),r.moveStart("character",-c.length),r.text=u,e.start=s.indexOf(o),e.end=s.lastIndexOf(o)-o.length,h=e.text.length-t.fixEolChars(f.value).length,h){for(r.moveStart("character",-u.length);h--;)u+="\n",e.end+=1;r.text=u}i.ieCachedRange&&(e.scrollTop=i.ieCachedScrollTop);i.ieCachedRange=null;this.setInputAreaSelection()}};this.restore=function(){e.text!=undefined&&e.text!=f.value&&(f.value=e.text);this.setInputAreaSelection();f.scrollTop=e.scrollTop};this.getChunks=function(){var n=new h;return n.before=t.fixEolChars(e.text.substring(0,e.start)),n.startTag="",n.selection=t.fixEolChars(e.text.substring(e.start,e.end)),n.endTag="",n.after=t.fixEolChars(e.text.substring(e.end)),n.scrollTop=e.scrollTop,n};this.setChunks=function(n){n.before=n.before+n.startTag;n.after=n.endTag+n.after;this.start=n.before.length;this.end=n.before.length+n.selection.length;this.text=n.before+n.selection+n.after;this.scrollTop=n.scrollTop};this.init()}function b(i,r,f,e,s,h,l){function v(n){var t;if(p.focus(),n.textOp){if(r&&r.setCommandMode(),t=new c(i),!t)return;var u=t.getChunks(),f=function(){p.focus();u&&t.setChunks(u);t.restore();parseAndRender()},e=n.textOp(u,f);e||f()}n.execute&&n.execute(r)}function w(t,r){r?(t.style.color="black",t.onmouseover=function(){t.style.color="orange"},t.onmouseout=function(){t.style.color="black"},u.isIE&&(t.onmousedown=function(){n.activeElement&&n.activeElement!==i.input||(i.ieCachedRange=document.selection.createRange(),i.ieCachedScrollTop=i.input.scrollTop)}),t.isHelp||(t.onclick=function(){return this.onmouseout&&this.onmouseout(),v(this),!1})):(t.style.color="gainsboro",t.onmouseover=t.onmouseout=t.onclick=function(){})}function y(n){return typeof n=="string"&&(n=f[n]),function(){n.apply(f,arguments)}}function d(){var p=i.buttonBar,r=document.createElement("ul"),c,t,v;r.id="wmd-button-row";r.className="wmd-button-row";r=p.appendChild(r);var u=0,n=function(n,t,i,f){var e=document.createElement("li");return e.className="wmd-button fa "+i,e.style.left=u+"px",u+=25,e.id=n,e.title=t,f&&(e.textOp=f),w(e,!0),r.appendChild(e),e},f=function(n){var t=document.createElement("li");t.className="wmd-spacer wmd-spacer"+n;t.id="wmd-spacer"+n;t.style.left=u-5+"px";r.appendChild(t);u+=25};a.bold=n("wmd-bold-button",l("bold"),"fa-bold",y("doBold"));a.italic=n("wmd-italic-button",l("italic"),"fa-italic",y("doItalic"));f(1);a.link=n("wmd-link-button",l("link"),"fa-link",y(function(n,t){return this.doLinkOrImage(n,t,!1,e)}));a.quote=n("wmd-quote-button",l("quote"),"fa-quote-left",y("doBlockquote"));a.code=n("wmd-code-button",l("code"),"fa-code",y("doCode"));s&&(a.image=n("wmd-image-button",l("image"),"fa-picture-o",y(function(n,t){return this.doLinkOrImage(n,t,!0,e)})));f(2);a.olist=n("wmd-olist-button",l("olist"),"fa-list-ol",y(function(n,t){this.doList(n,t,!0)}));a.ulist=n("wmd-ulist-button",l("ulist"),"fa-list-ul",y(function(n,t){this.doList(n,t,!1)}));a.heading=n("wmd-heading-button",l("heading"),"fa-header",y("doHeading"));a.hr=n("wmd-hr-button",l("hr"),"fa-minus-square-o",y("doHorizontalRule"));f(3);a.undo=n("wmd-undo-button",l("undo"),"fa-undo",null);a.undo.execute=function(n){n&&n.undo()};c=/win/.test(o.platform.toLowerCase())?l("redo"):l("redomac");a.redo=n("wmd-redo-button",c,"fa-repeat",null);a.redo.execute=function(n){n&&n.redo()};h&&(t=document.createElement("li"),v=document.createElement("span"),t.appendChild(v),t.className="wmd-button wmd-help-button",t.id="wmd-help-button",t.XShift="-240px",t.isHelp=!0,t.style.right="0px",t.title=l("help"),t.onclick=h.handler,w(t,!0),r.appendChild(t),a.help=t);k()}function k(){r&&(w(a.undo,r.canUndo()),w(a.redo,r.canRedo()))}var p=i.input,a={},b;d();b="keydown";u.isOpera&&(b="keypress");t.addEvent(p,b,function(n){if((n.ctrlKey||n.metaKey)&&!n.altKey&&!n.shiftKey){var t=n.charCode||n.keyCode,i=String.fromCharCode(t).toLowerCase();switch(i){case"b":v(a.bold);parseAndRender();break;case"i":v(a.italic);parseAndRender();break;case"l":v(a.link);parseAndRender();break;case"q":v(a.quote);parseAndRender();break;case"k":v(a.code);parseAndRender();break;case"g":v(a.image);parseAndRender();break;case"o":v(a.olist);parseAndRender();break;case"u":v(a.ulist);parseAndRender();break;case"h":v(a.heading);parseAndRender();break;case"r":v(a.hr);parseAndRender();break;case"y":v(a.redo);parseAndRender();break;case"z":n.shiftKey?(v(a.redo),parseAndRender()):(v(a.undo),parseAndRender());break;default:return}n.preventDefault&&n.preventDefault();window.event&&(window.event.returnValue=!1)}});t.addEvent(p,"keyup",function(n){var i,t;!n.shiftKey||n.ctrlKey||n.metaKey||(i=n.charCode||n.keyCode,i===13&&(t={},t.textOp=y("doAutoindent"),v(t)))});u.isIE&&t.addEvent(p,"keydown",function(n){var t=n.keyCode;if(t===27)return!1});this.setUndoRedoButtonStates=k}function l(n,t){this.hooks=n;this.getString=t}function k(n){return n.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(n,t,i){var r=!1;return t=t.replace(/%(?:[\da-fA-F]{2})|\?|\+|[^\w\d-./[\]]/g,function(n){if(n.length===3&&n.charAt(0)=="%")return n.toUpperCase();switch(n){case"?":return r=!0,"?";case"+":if(r)return"%20"}return encodeURI(n)}),i&&(i=i.trim?i.trim():i.replace(/^\s*/,"").replace(/\s*$/,""),i=i.replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),i?t+' "'+i+'"':t})}var t={},f={},e={},n=window.document,r=window.RegExp,o=window.navigator,s={lineLength:72},u={isIE:/msie/.test(o.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(o.userAgent.toLowerCase())||/msie 5/.test(o.userAgent.toLowerCase()),isOpera:/opera/.test(o.userAgent.toLowerCase())},a={bold:"Strong <strong> Ctrl+B",boldexample:"strong text",italic:"Emphasis <em> Ctrl+I",italicexample:"emphasized text",link:"Hyperlink <a> Ctrl+L",linkdescription:"enter link description here",linkdialog:'<p>Link to an exisiting URL: http://example.com/ "optional title"<\/p>',linkdialogupload:"<p>Browse for a File to upload<\/p>",quote:"Blockquote <blockquote> Ctrl+Q",quoteexample:"Blockquote",code:"Code Sample <pre><code> Ctrl+K",codeexample:"enter code here",image:"Image <img> Ctrl+G",imagedescription:"enter image description here",imagedialog:'<p>Link to an exisiting Image: http://example.com/images/diagram.jpg "optional title"<\/p>',imagedialogupload:"<p>Browse for an Image to upload<\/p>",olist:"Numbered List <ol> Ctrl+O",ulist:"Bulleted List <ul> Ctrl+U",litem:"List item",heading:"Heading <h1>/<h2> Ctrl+H",headingexample:"Heading",hr:"Horizontal Rule <hr> Ctrl+R",undo:"Undo - Ctrl+Z",redo:"Redo - Ctrl+Y",redomac:"Redo - Ctrl+Shift+Z",help:"Markdown Editing Help"},v="http://",y="http://",i;Markdown.Editor=function(t){var u,i,f,r;t=t||{};t.allowUploads==null&&(t.allowUploads=!1);t.allowImages==null&&(t.allowImages=!0);typeof t.handler=="function"&&(t={helpButton:t});t.strings=t.strings||{};t.helpButton&&(t.strings.help=t.strings.help||t.helpButton.title);u=function(n){return t.strings[n]||a[n]};i=this.hooks=new Markdown.HookCollection;i.addNoop("postBlockquoteCreation");i.addFalse("insertImageDialog");f=this;this.run=function(){if(!r){r=new p;var o=new l(i,u),e,f;/\?noundo/.test(n.location.href)||(e=new w(function(){f&&f.setUndoRedoButtonStates()},r),this.textOperation=function(n){e.setCommandMode();n()});f=new b(r,e,o,t.allowUploads,t.allowImages,t.helpButton,u);f.setUndoRedoButtonStates()}}};h.prototype.findTags=function(n,i){var r=this,u;n&&(u=t.extendRegExp(n,"","$"),this.before=this.before.replace(u,function(n){return r.startTag=r.startTag+n,""}),u=t.extendRegExp(n,"^",""),this.selection=this.selection.replace(u,function(n){return r.startTag=r.startTag+n,""}));i&&(u=t.extendRegExp(i,"","$"),this.selection=this.selection.replace(u,function(n){return r.endTag=n+r.endTag,""}),u=t.extendRegExp(i,"^",""),this.after=this.after.replace(u,function(n){return r.endTag=n+r.endTag,""}))};h.prototype.trimWhitespace=function(n){var t,i,r=this;n?t=i="":(t=function(n){return r.before+=n,""},i=function(n){return r.after=n+r.after,""});this.selection=this.selection.replace(/^(\s*)/,t).replace(/(\s*)$/,i)};h.prototype.skipLines=function(n,t,i){n===undefined&&(n=1);t===undefined&&(t=1);n++;t++;var u,f;if(navigator.userAgent.match(/Chrome/)&&"X".match(/()./),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+r.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+r.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+r.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+r.$1,this.before){for(u=f="";n--;)u+="\\n?",f+="\n";i&&(u="\\n*");this.before=this.before.replace(new r(u+"$",""),f)}if(this.after){for(u=f="";t--;)u+="\\n?",f+="\n";i&&(u="\\n*");this.after=this.after.replace(new r(u,""),f)}};t.isVisible=function(n){return window.getComputedStyle?window.getComputedStyle(n,null).getPropertyValue("display")!=="none":n.currentStyle?n.currentStyle.display!=="none":void 0};t.addEvent=function(n,t,i){n.attachEvent?n.attachEvent("on"+t,i):n.addEventListener(t,i,!1)};t.removeEvent=function(n,t,i){n.detachEvent?n.detachEvent("on"+t,i):n.removeEventListener(t,i,!1)};t.fixEolChars=function(n){return n=n.replace(/\r\n/g,"\n"),n.replace(/\r/g,"\n")};t.extendRegExp=function(n,t,i){(t===null||t===undefined)&&(t="");(i===null||i===undefined)&&(i="");var u=n.toString(),f;return u=u.replace(/\/([gim]*)$/,function(n,t){return f=t,""}),u=u.replace(/(^\/|\/$)/g,""),u=t+u+i,new r(u,f)};f.getTop=function(n,t){var i=n.offsetTop;if(!t)while(n=n.offsetParent)i+=n.offsetTop;return i};f.getHeight=function(n){return n.offsetHeight||n.scrollHeight};f.getWidth=function(n){return n.offsetWidth||n.scrollWidth};f.getPageSize=function(){var r,u,t,i,f,e;return self.innerHeight&&self.scrollMaxY?(r=n.body.scrollWidth,u=self.innerHeight+self.scrollMaxY):n.body.scrollHeight>n.body.offsetHeight?(r=n.body.scrollWidth,u=n.body.scrollHeight):(r=n.body.offsetWidth,u=n.body.offsetHeight),self.innerHeight?(t=self.innerWidth,i=self.innerHeight):n.documentElement&&n.documentElement.clientHeight?(t=n.documentElement.clientWidth,i=n.documentElement.clientHeight):n.body&&(t=n.body.clientWidth,i=n.body.clientHeight),f=Math.max(r,t),e=Math.max(u,i),[f,e,t,i]};e.createBackground=function(){var i=n.createElement("div"),t=i.style,r;return i.className="wmd-prompt-background",t.position="absolute",t.top="0",u.isIE?t.filter="alpha(opacity=50)":t.opacity="0.5",r=f.getPageSize(),t.height=r[1]+"px",u.isIE?(t.left=n.documentElement.scrollLeft,t.width=n.documentElement.clientWidth):(t.left="0",t.width="100%"),n.body.appendChild(i),i};e.prompt=function(i,r,e,o,s){var h,c;e===undefined&&(e="");var a=function(n){var t=n.charCode||n.keyCode;if(t===27)return n.stopPropagation&&n.stopPropagation(),l(!0),!1},l=function(i,r){var u;if(t.removeEvent(n.body,"keyup",a),u="",r&&!i)if(window.FormData!==undefined){var e=$("#FileUpload").get(0),s=e.files,f=new FormData;f.append("file",s[0]);$.ajax({url:"/MissionControl/Ajax/UploadFile",type:"POST",contentType:!1,processData:!1,data:f,async:!1,success:function(n){u=n},error:function(n){alert(n.statusText);i=!0}});u=="Empty"||u=="Error"?i=!0:u=="UnAuth"&&(alert("Error: Please log in to continue"),i=!0)}else alert("FormData is not supported."),i=!0;else u=c.value;return i?u=null:(u=u.replace(/^http:\/\/(https?|ftp):\/\//,"$1://"),/^(?:https?|ftp):\/\//.test(u)||(u="http://"+u)),h.parentNode.removeChild(h),o(u),!1},v=function(){var nt,tt,it,rt,p,ft,v,w,b,k,et,y,o,ut,d,g;h=n.createElement("div");h.className="wmd-prompt-dialog";h.style.padding="10px;";h.style.position="fixed";h.style.width="400px";nt=n.createElement("ul");nt.className="nav nav-tabs";h.appendChild(nt);s==!0&&(tt=n.createElement("li"),tt.innerHTML='<a data-toggle="tab" href="#uploadFile"><b>Upload File<\/b><\/a>',tt.className="active",tt.style.padding="5px",nt.appendChild(tt));it=n.createElement("li");it.innerHTML='<a data-toggle="tab" href="#inputUrl"><b>Input URL<\/b><\/a>';it.style.padding="5px";s==!1&&(it.className="active");nt.appendChild(it);rt=n.createElement("div");rt.className="tab-content";h.appendChild(rt);p=n.createElement("div");p.id="inputUrl";p.className=s==!0?"tab-pane":"tab-pane active";rt.appendChild(p);ft=n.createElement("div");ft.innerHTML=i;p.appendChild(ft);v=n.createElement("form");o=v.style;v.onsubmit=function(){return l(!1,!1)};o.padding="0";o.margin="0";o.cssFloat="left";o.width="100%";o.textAlign="center";o.position="relative";p.appendChild(v);c=n.createElement("input");c.type="text";c.value=e;o=c.style;o.display="block";o.width="80%";o.marginLeft=o.marginRight="auto";v.appendChild(c);w=n.createElement("input");w.type="button";w.onclick=function(){return l(!1,!1)};w.value="OK";o=w.style;o.margin="10px";o.display="inline";o.width="7em";b=n.createElement("input");b.type="button";b.onclick=function(){return l(!0,!1)};b.value="Cancel";o=b.style;o.margin="10px";o.display="inline";o.width="7em";v.appendChild(w);v.appendChild(b);s==!0&&(k=n.createElement("div"),k.id="uploadFile",k.className="tab-pane active",rt.appendChild(k),et=n.createElement("div"),et.innerHTML=r,k.appendChild(et),y=n.createElement("form"),o=y.style,y.onsubmit=function(){return l(!1,!0)},o.padding="0",o.margin="0",o.cssFloat="left",o.width="100%",o.textAlign="center",o.position="relative",k.appendChild(y),ut=n.createElement("input"),ut.type="file",ut.id="FileUpload",o=c.style,o.display="block",o.width="80%",o.marginLeft=o.marginRight="auto",y.appendChild(ut),d=n.createElement("input"),d.type="button",d.onclick=function(){return l(!1,!0)},d.value="OK",o=d.style,o.margin="10px",o.display="inline",o.width="7em",g=n.createElement("input"),g.type="button",g.onclick=function(){return l(!0,!0)},g.value="Cancel",o=g.style,o.margin="10px",o.display="inline",o.width="7em",y.appendChild(d),y.appendChild(g));t.addEvent(n.body,"keyup",a);h.style.top="50%";h.style.left="50%";h.style.display="block";u.isIE_5or6&&(h.style.position="absolute",h.style.top=n.documentElement.scrollTop+200+"px",h.style.left="50%");n.body.appendChild(h);h.style.marginTop=-(f.getHeight(h)/2)+"px";h.style.marginLeft=-(f.getWidth(h)/2)+"px"};setTimeout(function(){var t,n;v();t=e.length;c.selectionStart!==undefined?(c.selectionStart=0,c.selectionEnd=t):c.createTextRange&&(n=c.createTextRange(),n.collapse(!1),n.moveStart("character",-t),n.moveEnd("character",t),n.select());c.focus()},0)};i=l.prototype;i.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)";i.unwrap=function(n){var t=new r("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");n.selection=n.selection.replace(t,"$1 $2")};i.wrap=function(n,t){this.unwrap(n);var i=new r("(.{1,"+t+"})( +|$\\n?)","gm"),u=this;n.selection=n.selection.replace(i,function(n,t){return new r("^"+u.prefixes,"").test(n)?n:t+"\n"});n.selection=n.selection.replace(/\s+$/,"")};i.doBold=function(n,t){return this.doBorI(n,t,2,this.getString("boldexample"))};i.doItalic=function(n,t){return this.doBorI(n,t,1,this.getString("italicexample"))};i.doBorI=function(n,t,i,u){var s,e;n.trimWhitespace();n.selection=n.selection.replace(/\n{2,}/g,"\n");var h=/(\**$)/.exec(n.before)[0],f=/(^\**)/.exec(n.after)[0],o=Math.min(h.length,f.length);o>=i&&(o!=2||i!=1)?(n.before=n.before.replace(r("[*]{"+i+"}$",""),""),n.after=n.after.replace(r("^[*]{"+i+"}",""),"")):!n.selection&&f?(n.after=n.after.replace(/^([*_]*)/,""),n.before=n.before.replace(/(\s?)$/,""),s=r.$1,n.before=n.before+f+s):(n.selection||f||(n.selection=u),e=i<=1?"*":"**",n.before=n.before+e,n.after=e+n.after);return};i.stripLinkDefs=function(n,t){return n.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(n,i,r,u,f){return(t[i]=n.replace(/\s*$/,""),u)?(t[i]=n.replace(/["(](.+?)[")]$/,""),u+f):""})};i.addLinkDef=function(n,t){var f=0,u={},y;n.before=this.stripLinkDefs(n.before,u);n.selection=this.stripLinkDefs(n.selection,u);n.after=this.stripLinkDefs(n.after,u);for(var c="",r=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,l=n.before+n.selection+n.after,s=l,e="http://this-is-a-real-link.biz/";s.indexOf(e)!=-1;)e+="nicetry/";var a="\n\n",i=0,p=l.replace(r,function w(n,t,u,f,o,s,h){i+=h;a+=" ["+i+"]: "+e+i+"/unicorn\n";i+=t.length;u=u.replace(r,w);i-=t.length;var c=t+u+f+i+s;return i-=h,c});s=p+a;var b=function(n){return s.indexOf(e+n+"/unicorn")!==-1},v=function(n){f++;n=n.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+f+"]:");c+="\n"+n},o=function(n,t,e,s,h,c,l){return b(i+l)?(i+=l+t.length,e=e.replace(r,o),i-=l+t.length,u[h])?(v(u[h]),t+e+s+f+c):n:n},h=n.before.length;return n.before=n.before.replace(r,o),i+=h,h=n.selection.length,t?v(t):n.selection=n.selection.replace(r,o),i+=h,y=f,n.after=n.after.replace(r,o),n.after&&(n.after=n.after.replace(/\n*$/,"")),n.after||(n.selection=n.selection.replace(/\n*$/,"")),n.after+="\n\n"+c,y};i.doLinkOrImage=function(n,t,i,r){var o,u,f;if(n.trimWhitespace(),n.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/),n.endTag.length>1&&n.startTag.length>0)n.startTag=n.startTag.replace(/!?\[/,""),n.endTag="",this.addLinkDef(n,null);else{if(n.selection=n.startTag+n.selection+n.endTag,n.startTag=n.endTag="",/\n\n/.test(n.selection)){this.addLinkDef(n,null);return}return u=this,f=function(r){if(o.parentNode.removeChild(o),r!==null){n.selection=(" "+n.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var f=" [999]: "+k(r),e=u.addLinkDef(n,f);n.startTag=i?"![":"[";n.endTag="]["+e+"]";n.selection||(n.selection=i?u.getString("imagedescription"):u.getString("linkdescription"))}t()},o=e.createBackground(),i?this.hooks.insertImageDialog(f)||e.prompt(this.getString("imagedialog"),this.getString("imagedialogupload"),v,f,r):e.prompt(this.getString("linkdialog"),this.getString("linkdialogupload"),y,f,r),!0}};i.doAutoindent=function(n){var t=this,i=!1;n.before=n.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n");n.before=n.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n");n.before=n.before.replace(/(\n|^)[ \t]+\n$/,"\n\n");n.selection||/^[ \t]*(?:\n|$)/.test(n.after)||(n.after=n.after.replace(/^[^\n]*/,function(t){return n.selection=t,""}),i=!0);/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(n.before)&&t.doList&&t.doList(n);/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(n.before)&&t.doBlockquote&&t.doBlockquote(n);/(\n|^)(\t|[ ]{4,}).*\n$/.test(n.before)&&t.doCode&&t.doCode(n);i&&(n.after=n.selection+n.after,n.selection="")};i.doBlockquote=function(n){var t,u,i,o,r,f,e,h;if(n.selection=n.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(t,i,r,u){return n.before+=i,n.after=u+n.after,r}),n.before=n.before.replace(/(>[ \t]*)$/,function(t,i){return n.selection=i+n.selection,""}),n.selection=n.selection.replace(/^(\s|>)+$/,""),n.selection=n.selection||this.getString("quoteexample"),t="",u="",n.before){for(o=n.before.replace(/\n$/,"").split("\n"),r=!1,f=0;f<o.length;f++)e=!1,i=o[f],r=r&&i.length>0,/^>/.test(i)?(e=!0,!r&&i.length>1&&(r=!0)):e=/^[ \t]*$/.test(i)?!0:r,e?t+=i+"\n":(u+=t+i,t="\n");/(^|\n)>/.test(t)||(u+=t,t="")}n.startTag=t;n.before=u;n.after&&(n.after=n.after.replace(/^\n?/,"\n"));n.after=n.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(t){return n.endTag=t,""});h=function(t){var i=t?"> ":"";n.startTag&&(n.startTag=n.startTag.replace(/\n((>|\s)*)\n$/,function(n,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,i)+"\n"}));n.endTag&&(n.endTag=n.endTag.replace(/^\n((>|\s)*)\n/,function(n,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,i)+"\n"}))};/^(?![ ]{0,3}>)/m.test(n.selection)?(this.wrap(n,s.lineLength-2),n.selection=n.selection.replace(/^/gm,"> "),h(!0),n.skipLines()):(n.selection=n.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(n),h(!1),!/^(\n|^)[ ]{0,3}>/.test(n.selection)&&n.startTag&&(n.startTag=n.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(n.selection)&&n.endTag&&(n.endTag=n.endTag.replace(/^\n{0,2}/,"\n\n")));n.selection=this.hooks.postBlockquoteCreation(n.selection);/\n/.test(n.selection)||(n.selection=n.selection.replace(/^(> *)/,function(t,i){return n.startTag+=i,""}))};i.doCode=function(n){var r=/\S[ ]*$/.test(n.before),u=/^[ ]*\S/.test(n.after),t,i;(u||r)&&!/\n/.test(n.selection)?(n.trimWhitespace(),n.findTags(/`/,/`/),n.startTag||n.endTag?n.endTag&&!n.startTag?(n.before+=n.endTag,n.endTag=""):n.startTag=n.endTag="":(n.startTag=n.endTag="`",n.selection||(n.selection=this.getString("codeexample")))):(n.before=n.before.replace(/[ ]{4}$/,function(t){return n.selection=t+n.selection,""}),t=1,i=1,/(\n|^)(\t|[ ]{4,}).*\n$/.test(n.before)&&(t=0),/^\n(\t|[ ]{4,})/.test(n.after)&&(i=0),n.skipLines(t,i),n.selection?/^[ ]{0,3}\S/m.test(n.selection)?/\n/.test(n.selection)?n.selection=n.selection.replace(/^/gm,"    "):n.before+="    ":n.selection=n.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\t)/gm,""):(n.startTag="    ",n.selection=this.getString("codeexample")))};i.doList=function(n,t,i){var l=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,a="-",v=1,y=function(){var n;return i?(n=" "+v+". ",v++):n=" "+a+" ",n},u=function(n){return i===undefined&&(i=/^\s*\d/.test(n)),n.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(){return y()})},f,e,o,h,c;(n.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!n.before||/\n$/.test(n.before)||/^\n/.test(n.startTag)||(n.before+=n.startTag,n.startTag=""),n.startTag&&(f=/\d+[.]/.test(n.startTag),n.startTag="",n.selection=n.selection.replace(/\n[ ]{4}/g,"\n"),this.unwrap(n),n.skipLines(),f&&(n.after=n.after.replace(l,u)),i==f))||(e=1,n.before=n.before.replace(/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,function(n){return/^\s*([*+-])/.test(n)&&(a=r.$1),e=/[^\n]\n\n[^\n]/.test(n)?1:0,u(n)}),n.selection||(n.selection=this.getString("litem")),o=y(),h=1,n.after=n.after.replace(l,function(n){return h=/[^\n]\n\n[^\n]/.test(n)?1:0,u(n)}),n.trimWhitespace(!0),n.skipLines(e,h,!0),n.startTag=o,c=o.replace(/./g," "),this.wrap(n,s.lineLength-c.length),n.selection=n.selection.replace(/\n/g,"\n"+c))};i.doHeading=function(n){var t,u,f,i;if(n.selection=n.selection.replace(/\s+/g," "),n.selection=n.selection.replace(/(^\s+|\s+$)/g,""),!n.selection){n.startTag="## ";n.selection=this.getString("headingexample");return}if(t=0,n.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(n.startTag)&&(t=r.lastMatch.length),n.startTag=n.endTag="",n.findTags(null,/\s?(-+|=+)/),/=+/.test(n.endTag)&&(t=1),/-+/.test(n.endTag)&&(t=2),n.startTag=n.endTag="",n.skipLines(1,1),u=t==0?2:t-1,u>0)for(f=u>=2?"-":"=",i=n.selection.length,i>s.lineLength&&(i=s.lineLength),n.endTag="\n";i--;)n.endTag+=f};i.doHorizontalRule=function(n){n.startTag="----------\n";n.selection="";n.skipLines(2,1,!0)}}();